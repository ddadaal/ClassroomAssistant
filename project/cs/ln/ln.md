## 4.1 第2次迭代

### 4.1.1 分解系统组件

选择**上传模块**继续分解。

### 4.1.2 确定架构驱动因素（重要性、难易度从高到低）

| #    | 架构驱动因素                                                 | 重要性 | 难易度 |
| ---- | ------------------------------------------------------------ | ------ | ------ |
| 1    | 场景1：大量用户短时间内进行数据量交换较小的操作（签到、举手、获取或者提交试卷） | 高     | 高     |
| 2    | 场景6：断线重连                                              | 高     | 高     |
| 3    | 场景7：学生数据防止被攻击和篡改                              | 高     | 中     |
| 4    | 场景9：学生使用过程中撤销错误操作                            | 中     | 中     |
| 5    | 场景10：用户请求服务                                         | 中     | 中     |
| 6    | 场景11：用户请求其他用户的信息                               | 中     | 中     |
| 7    | 场景12：文件上传和下载                                       | 高     | 中     |

### 4.1.3 选择满足架构驱动因素的架构模式

#### 4.1.3.1 设计关注点

| 质量属性 | 设计关注点   | 子关注点                           |
| -------- | ------------ | ---------------------------------- |
| 安全性   | 数据源采集   | 数据源压缩编码                     |
| 性能     | 上传数据传输 | 上传数据传输协议、上传数据效率     |
| 安全性   | 上传数据处理 | 上传数据处理方式、上传数据处理效率 |
| 可用性   | 上传进度     | 上传断点记录、上传数据拆分方式     |

#### 4.1.3.2 候选模式

**数据源压缩编码**

| #    | 模式名称 | 压缩率 | 容错能力 | CPU能力要求 | 压缩时间 |
| ---- | -------- | ------ | -------- | ----------- | -------- |
| 1    | RAR压缩  | 高     | 高       | 高          | 中       |
| 2    | ZIP压缩  | 中     | 低       | 高          | 高       |

选择模式：RAR压缩
选择理由：ZIP占存过大，并且只有英文版，RAR具有官方简体中文且安装包较小，同时RAR压缩率高容错能力高，相比ZIP能支持更多的流行压缩格式。最为关键的是在传输超大型文件过程中RAR支持分卷压缩，降低了上传压力。

**上传数据传输协议**

| #    | 模式名称 | 可靠性 | 实时性 | 连续性 | 完整性 |
| ---- | -------- | ------ | ------ | ------ | ------ |
| 1    | TCP协议  | 强     | 弱     | 一般   | 强     |
| 2    | UDP协议  | 弱     | 强     | 一般   | 弱     |

选择模式：TCP协议
选择理由：TCP协议是面向连接的可靠协议，如果发现分组有丢失现象，会请求进行重传，保证了数据的准确性，保证了数据有序传输。而UDP协议是无连接校验机制的，不会进行数据的校准和分组确认，且传输数据是无序的。我们的系统需要传输的可靠性合完整性，否则可能严重缺失导致稳健运行失败。所以选择TCP协议。

**上传数据效率**

| #    | 模式名称             | 传输效率 | 可用性 | 同时上传数量 |
| ---- | -------------------- | -------- | ------ | ------------ |
| 1    | 提升服务器带宽       | 高       | 中     | 中           |
| 2    | 使用分布式服务器     | 高       | 高     | 多           |
| 3    | 提高客户端的上行带宽 | 中       | 中     | 中           |

选择模式：使用分布式服务器，并根据需求提升个服务器带宽
选择理由：传输效率主要由服务器总带宽和客户端的上行贷款决定，使用分布式服务器不仅可以提升总带宽，而且有更高的可用性合容错性。而且分布式可以在发现相同资源的情况下提高上传的并发量。

**上传数据处理方式**

| #    | 模式名称                                 | 性能要求 | 成本 | 安全性 | 处理效率 |
| ---- | ---------------------------------------- | -------- | ---- | ------ | -------- |
| 1    | 直接存储                                 | 低       | 低   | 低     | 高       |
| 2    | 把文件解压扫描，检查是否有病毒后存储     | 高       | 高   | 高     | 低       |
| 3    | 只解压一小部分文件，检查是否有病毒后存储 | 中       | 中   | 中     | 中       |

选择模式：模式3
选择理由：直接存储安全性太低，全部解压扫描效率太低，所以选择解压部分扫描抽查。

**上传数据处理效率**

| #    | 模式名称               | 处理速率 | 可伸缩性 | 可用性 |
| ---- | ---------------------- | -------- | -------- | ------ |
| 1    | 使用RAD5存储上传的数据 | 中       | 中       | 高     |
| 2    | 边解压边分析数据       | 高       | 高       | 低     |
| 3    | 解压完成再分析数据     | 中       | 中       | 低     |

选择模式：模式1and模式2
选择理由：系统突然崩溃时可使用另外一个校验信息，恢复之前上传的数据，提高了可用性，使用边解压边分析有效提高了数据的处理效率。

**上传断点记录**

| #    | 模式名称             | 上传速率 | 可用性 | 可同时上传数量 |
| ---- | -------------------- | -------- | ------ | -------------- |
| 1    | 自定义断点交互协议   | 中       | 高     | 高             |
| 2    | 使用http断点下载协议 | 高       | 高     | 中             |

选择模式：模式1
选择理由：自定义断点交互协议可以让游览器记住最近一次成功传输的位置，也可以把上传的断点放在服务器端。

**上传数据拆分方式**

| #    | 模式名称          | 处理速率 | 可伸缩性 | 可用性 |
| ---- | ----------------- | -------- | -------- | ------ |
| 1    | 定义拆分单元为1M  | 中       | 高       | 高     |
| 2    | 定义拆分单元为10M | 高       | 中       | 中     |

选择模式：模式1
选择理由：传输单元为1M，没有占用太多的传输通道，可以增加更多的并发，使得统一用户在同一时间，上传更多的文件。

### 4.1.4 候选模式与对应ASR

| #    | 模式类型         | 选择的模式                                   | 架构驱动 |
| ---- | ---------------- | -------------------------------------------- | -------- |
| 1    | 数据源压缩编码   | RAR压缩                                      |          |
| 2    | 上传数据传输协议 | TCP协议                                      |          |
| 3    | 上传数据效率     | 使用分布式服务器，并根据需求提升个服务器带宽 |          |
| 4    | 上传数据处理方式 | 只解压一小部分文件，检查是否有病毒后存储     |          |
| 5    | 上传数据处理效率 | 使用RAD5存储上传的数据、边解压边分析数据     |          |
| 6    | 上传断点记录     | 自定义断点交互协议                           |          |
| 7    | 上传数据拆分方式 | 定义拆分单元为1M                             |          |

### 4.1.5 架构视图

图片

## 4.1 第3次迭代

### 4.1.1 分解系统组件

选择**推送模块**继续分解。

### 4.1.2 确定架构驱动因素（重要性、难易度从高到低）

| #    | 架构驱动因素 | 重要性 | 难易度 |
| ---- | ------------ | ------ | ------ |
| 1    | ...          | 高     | 高     |

### 4.1.3 选择满足架构驱动因素的架构模式

#### 4.1.3.1 设计关注点

| 质量属性 | 设计关注点 | 子关注点  |
| -------- | ---------- | --------- |
| 质量属性 | 关注点     | 子关注点1 |
| 质量属性 | 关注点     | 子关注点2 |

#### 4.1.3.2 候选模式

**子关注点1**

| #    | 模式名称 | 比较1 | 比较 2 |
| ---- | -------- | ----- | ------ |
| 1    | 模式1    | 高    | 高     |

选择模式：模式1
选择理由：。。。

### 4.1.4 候选模式与对应ASR

| #    | 模式类型 | 选择的模式 | 架构驱动 |
| ---- | -------- | ---------- | -------- |
| 1    | ..       | ..         | ..       |

### 4.1.5 架构视图

图片