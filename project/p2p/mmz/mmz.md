## 3.8 第八次迭代
---
### 3.8.1 分解系统组件
本迭代分解客户端节点的发言举手模块。

### 3.8.2 确定架构驱动因素
| # |架构驱动因素|重要性|难易度|
|----|----|----|----|
|1|场景1：大量用户短时间内进行数据量交换较小的操作|高|高|
|2|场景3：系统故障|中|中|
|3|场景6：断线重连|低|中|
|4|场景9：学生使用过程中撤销错误操作|高|中|
|5|场景10：用户请求服务|高|高|
|6|场景11：用户请求其他用户的信息|高|中|

### 3.8.3 选择架构模式
#### 3.8.3.1 设计关注点
|质量属性|设计关注点|子关注点|
|---|---|---|
|性能|资源管理|数据交换速度度量|
|可用性|客户端节点可用性监测|对客户端节点透明|
|可用性|客户端节点故障恢复|对客户端节点透明<br>保持数据一致性|
|易用性|支持用户动机|撤销操作|
|可靠性|客户端节点信息正确可用|检测失效客户端节点|

#### 3.8.3.2 候选模式
**数据交换速度度量**

|#|模式|精确度|性能|
|---|---|---|---|
|1|度量每次请求的时间|H|M|
|2|度量样本请求的时间|M|H|
|3|度量模拟请求的时间|M|H|

选择模式：模式2

理由：每次请求都度量时间会导致系统延迟增大,所以不可取;模拟请求的开支虽然较小,但仅仅为了度量数据交换速度而发送请求也会消耗一定网络资源;因此选择抽取一定量样本进行度量

**保持数据一致性**

数据一致性由客户端节点的持久化模块实现.

**对客户端节点透明**

|#|模式|通信方式|超时位置|
|---|---|---|---|
|1|客户端节点处理故障|单播|客户端节点|
|2|代理处理故障|单播|代理|
|3|基础设施处理故障|广播|基础设施内部|

选择模式：模式2

理由：在客户端处理故障要求客户端节点了解故障的细节，可能会导致系统不够鲁棒；在基础设施内处理故障，广播会占用较大的带宽，因此选择用代理。

**撤销操作**

|#|模式|易用性|性能代价|
|---|---|---|---|
|1|命令模式|H|M|
|2|客户端节点提供撤销接口|H|M|

选择模式: 模式2

理由: 使用命令模式保存举手信息会造成较大的内存消耗,因此选择专门提供举手信息的撤销接口.

**检测失效客户端节点**

|#|模式|反应速度|通信负载|
|---|---|---|---|
|1|心跳机制|快|每秒1次|
|2|ping/echo机制|快|每秒1次|
|3|客户端检测+广播|慢|1+N次|

选择模式：模式2

理由：心跳机制要求教师所持节点保存所有的学生持有节点,且需要定期发送心跳信息,容易造成通信瓶颈;客户端检测失效节点并向其他人广播会占用大量的通信带宽，并且网络的更新有延时，其他客户端节点不一定能及时得知失效节点;因此选择ping/echo机制。

### 3.8.4 候选模式与对应ASR

| # | 模式类型 | 选择的模式 | 架构驱动 |
|---|---|---|---|
|1|数据交换速度度量|度量样本请求的时间|场景1：大量用户短时间内进行数据量交换较小的操作|
|2|数据完整性|无|场景3：系统故障|
|3|对客户端节点透明|代理处理故障|场景3：系统故障<br>场景10：用户请求服务|
|4|撤销操作|客户端节点提供撤销接口|场景9:学生使用过程中撤销错误操作|
|5|检测失效客户端节点|ping/echo机制|场景6：断线重连<br>场景11：用户请求其他用户的信息|

### 3.8.5 架构视图

**c&c视图**

![server-register c&c]()

**模块视图**

![server-register model]()


## 3.9 第九次迭代
---
### 3.9.1 分解系统组件
本迭代分解客户端节点的讨论模块。

### 3.9.2 确定架构驱动因素
|#|架构驱动因素|重要性|难易度|
|---|---|---|---|
|1|场景2：用户正常操作|中|高|
|2|场景3：系统故障|中|中|
|3|场景6：断线重连|高|中|
|4|场景10：用户请求服务|高|中|
|5|场景11：用户请求其他用户的信息|高|中|

### 3.9.3 选择架构模式
#### 3.9.3.1 设计关注点
|质量属性|设计关注点|子关注点|
|---|---|---|
|性能|控制资源需求|限制执行时间<br>限制资源响应|
|性能|管理资源|维护数据备份|
|可用性|客户端节点可用性监测|对客户端节点透明|
|可用性|客户端节点故障恢复|对客户端节点透明|
|可靠性|客户端节点信息正确可用|检测失效客户端节点|

#### 3.9.3.2 候选模式

**限制执行时间**

|#|模式|性能|实现难度|
|---|---|---|---|
|1|异步定时终止|H|M|

选择模式：模式1

理由：在接受请求后即异步定时终止执行,实现简单且性能较好

**限制资源响应**
|#|模式|性能|实现难度|
|---|---|---|---|
|1|定长请求队列|H|M|
|2|不限长请求队列|M|M|

选择模式：模式1

理由：不限长请求队列可能会导致请求处理缓慢,无法满足质量需求,因此选择模式1

**维护数据备份**

|#|模式|通信性能|存储性能|
|----|----|----|----|
|1|实时备份|M|M|
|2|定期备份|M|H|

选择模式: 模式2

理由: 采用实时备份显然会造成IO资源的大量消耗,同时频繁备份本身也会消耗网络资源,因此选择定期备份。

**对客户端节点透明**

|#|模式|通信方式|超时位置|
|---|---|---|---|
|1|客户端节点处理故障|单播|客户端节点|
|2|代理处理故障|单播|代理|
|3|基础设施处理故障|广播|基础设施内部|

选择模式：模式2

理由：在客户端处理故障要求客户端节点了解故障的细节，可能会导致系统不够鲁棒；在基础设施内处理故障，广播会占用较大的带宽，因此选择用代理。

**检测失效客户端节点**

|#|模式|反应速度|通信负载|
|---|---|---|---|
|1|心跳机制|快|每秒1次|
|2|ping/echo机制|快|每秒1次|
|3|客户端检测+广播|慢|1+N次|

选择模式：模式1

理由：ping/echo机制要求各客户端节点向参与讨论的节点发送信息,会造成较大的资源消耗;客户端检测失效节点并向其他人广播会占用大量的通信带宽，并且网络的更新有延时，其他客户端节点不一定能及时得知失效节点;因此选择心跳机制。

### 3.9.4 候选模式与对应ASR

| # | 模式类型 | 选择的模式 | 架构驱动 |
| --- | --- | --- | --- |
|1|限制执行时间|异步定时终止|场景2：用户正常操作|
|2|限制资源响应|定长请求队列|场景2：用户正常操作|
|3|维护数据备份|维护数据备份|场景2：用户正常操作|
|4|对客户端节点透明|对客户端节点透明|场景3：系统故障<br>场景6：断线重连<br>场景10：用户请求服务|
|5|检测失效客户端节点|检测失效客户端节点|场景11：用户请求其他用户的信息|

### 3.9.5 架构视图
**c&c视图**

![server-register c&c]()

**模块视图**

![server-register model]()
